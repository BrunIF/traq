<div class="timeline content">
	<h2 id="page_title"><?php echo l('timeline'); ?></h2>

	<?php foreach ($days as $day) { ?>
	<h3><?php echo ldate(settings('timeline_day_format'), $day['created_at']); ?></h3>
	<dl>
	<?php foreach ($day['activity'] as $row) { ?>
		<dt>
			<span class="time"><?php echo ldate(settings('timeline_time_format'), $row->created_at); ?></span>
<?php if (in_array($row->action, array('ticket_created','ticket_closed','ticket_reopened'))) { ?>
			<?php echo HTML::link(
				l("timeline.{$row->action}",
					array(
						'ticket_summary'     => htmlspecialchars($row->ticket()->summary),
						'ticket_id'          => $row->ticket()->ticket_id,
						'ticket_type_name'   => $row->ticket()->type->name,
						'ticket_status_name' => $row->ticket_status()->name
					)
				),
				$row->ticket()->href()
			); ?>
<?php } elseif (in_array($row->action, array('milestone_completed', 'milestone_cancelled'))) { ?>
			<?php echo l("timeline.{$row->action}", array('milestone_name' => $row->milestone()->name)); ?>
<?php } elseif ($row->action == 'ticket_comment') { ?>
			<?php echo l('timeline.ticket_comment', array('link' => HTML::link(htmlspecialchars($row->ticket()->summary), $row->ticket()->href()), 'ticket_id' => $row->ticket()->ticket_id)); ?>
<?php } elseif ($row->action == 'ticket_moved_from' or $row->action == 'ticket_moved_to') { ?>
			<?php echo l("timeline.{$row->action}", array('ticket' => HTML::link(htmlspecialchars($row->ticket()->summary), $row->ticket()->href()), 'project' => HTML::link($row->other_project()->name, $row->other_project()->href())))?>
<?php } elseif ($row->action == 'wiki_page_created' or $row->action == 'wiki_page_edited') { ?>
			<?php echo l("timeline.{$row->action}", array('title' => HTML::link($row->wiki_page()->title, $row->wiki_page()->href()), 'slug' => $row->wiki_page()->slug))?>
<?php } ?>
		</dt>
		<dd><?php echo l('timeline.by_x', HTML::link(strshorten($row->user->name, 20), $row->user->href())); ?></dd>
	<?php } ?>
	</dl>
	<?php } ?>
</div>
<?php echo View::render('layouts/_pagination'); ?>
